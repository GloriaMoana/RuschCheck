{% extends 'layout.html' %} {% block content %}

<div class="max-w-6xl mx-auto">
  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-3xl font-bold text-gray-800">{{ main_location.name }}</h2>
    <p class="text-gray-500">{{ main_location.address }}</p>

    <a href="{{ url_for('spaces') }}" class="text-blue-600 underline text-sm">
      ‚Üê Back to Main Locations
    </a>
  </div>

  <!-- Sub Locations Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {% for sub in sub_locations %}
    <div
      class="space-card bg-white rounded-xl shadow border overflow-hidden flex"
    >
      <!-- Image -->
      <img
        src="{{ url_for('static', filename=sub.image.replace('\\','/')) }}"
        class="w-48 h-full object-cover"
        onerror="this.src='{{ url_for('static', filename='uploads/images/default.jpg') }}'"
      />

      <!-- Content -->
      <div class="p-4 flex-1 flex flex-col justify-between">
        <!-- üîπ SUB LOCATION NAME -->
        <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ sub.name }}</h3>

        <div class="space-y-1 text-sm text-gray-700">
          <div>Capacity: <strong>{{ sub.capacity }}</strong></div>

          <div>
            People detected:
            <strong id="people-{{ sub.id }}">
              {{ sub.average_people or 0 }}
            </strong>
          </div>

          <div>
            Congestion:
            <strong
              id="level-{{ sub.id }}"
              class="{% if sub.level == 'High' %}text-red-600{% elif sub.level == 'Medium' %}text-yellow-600{% else %}text-green-600{% endif %}"
            >
              {{ sub.level or "Not checked" }}
            </strong>
          </div>

          <div class="text-xs text-gray-500">
            Last checked:
            <span id="time-{{ sub.id }}"> {{ sub.updated_at or "-" }} </span>
          </div>

          <!-- Progress bar -->
          <div class="mt-2">
            <div class="h-3 bg-gray-200 rounded">
              <div
                id="bar-{{ sub.id }}"
                class="h-3 rounded transition-all duration-700 {% if sub.level == 'High' %}bg-red-500 {% elif sub.level == 'Medium' %}bg-yellow-400 {% else %}bg-green-500{% endif %}"
                style="width: {{ sub.percent or 0 }}%"
              ></div>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              <span id="percent-{{ sub.id }}">{{ sub.percent or 0 }}</span>%
              full
            </p>
          </div>
        </div>

        <!-- Buttons -->
        <div class="flex gap-2 mt-4">
          <button
            class="check-btn flex-1 py-1 rounded text-white bg-blue-600"
            data-loc="{{ sub.id }}"
          >
            Check
          </button>

          <button
            class="prev-btn flex-1 bg-gray-200 text-gray-700 py-1 rounded text-sm"
            data-loc="{{ sub.id }}"
          >
            Previous
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Modal -->
<div
  id="modal"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 hidden"
>
  <div class="modal-content bg-white rounded-lg p-6 w-96 relative">
    <button
      id="modalClose"
      class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
    >
      ‚úï
    </button>

    <h3 id="modalTitle" class="text-xl font-semibold"></h3>
    <p class="mt-2">Congestion Level: <strong id="modalLevel"></strong></p>
    <p>Average people: <strong id="modalPeople"></strong></p>
    <p>Capacity: <strong id="modalCapacity"></strong></p>
    <p>Percent full: <strong id="modalPercent"></strong>%</p>
  </div>
</div>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}
