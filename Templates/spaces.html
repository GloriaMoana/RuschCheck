{% extends 'layout.html' %} {% block content %}

<div class="max-w-6xl mx-auto">
  <h2 class="text-2xl font-bold mb-4">Spaces</h2>

  <!-- dynamic addition of location by using for key of the locations that are in teh app.py file-->
  <div class="grid grid-cols-2 gap-6">
    {% for key, loc in locations.items() %}
    <div
      class="space-card bg-white rounded-lg shadow flex overflow-hidden transition-all"
    >
      <!--if no thumbnail is assigned for the spaces it is given a default one of san jose state -->
      <img
        src="{{ url_for('static', filename=loc.image) }}"
        class="w-48 h-36 object-cover"
        onerror="this.src='{{ url_for('static', filename='images/default.jpg') }}'"
      />

      <!-- right side layout of the space page of the boxes-->
      <div class="p-4 flex-1">
        <div class="flex justify-between items-start">
          <div>
            <h3 class="font-semibold">{{ loc.name }}</h3>
            <div class="text-sm text-gray-500">
              Capacity: {{ loc.capacity }}
            </div>
          </div>

          <div class="flex flex-col items-end gap-2">
            <div
              id="indicator-{{ key }}"
              class="w-6 h-6 rounded-full border-2 border-gray-200 bg-white"
            ></div>

            <button
              class="check-btn bg-teal-500 text-white px-3 py-1 rounded"
              data-loc="{{ key }}"
            >
              {% if key in statuses %}Check Again{% else %}Check{% endif %}
            </button>

            <button
              class="prev-btn bg-gray-300 text-gray-800 px-3 py-1 rounded text-xs"
              data-loc="{{ key }}"
            >
              View Previous
            </button>
            <!-- get an error but it is fine still runs just an ide detection error -->
            <button
              class="bg-blue-500 text-white px-3 py-1 rounded text-xs"
              onclick="window.open('https://www.google.com/maps/search/?api=1&query={{ loc.address|urlencode }}','_blank')"
            >
              Directions
            </button>
          </div>
        </div>

        <!--Getting the congestion  levels from the db  and the last time it was updated usign a sqlite db from flask-->
        <div class="mt-3 text-sm text-gray-600">
          <strong>Congestion:</strong>
          <span id="cong-{{ key }}">
            {% if key in statuses %} {{ statuses[key]['level'] }} {% else %} Not
            checked {% endif %}
          </span>

          <div class="text-xs text-gray-400">
            Last updated:
            <span id="time-{{ key }}">
              {% if key in statuses %} {{ statuses[key]['updated_at'] }} {% else
              %} - {% endif %}
            </span>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Modal -->
  <div
    id="modal"
    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 hidden"
  >
    <div class="bg-white rounded-lg p-6 w-96 relative">
      <button
        id="modalClose"
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
      >
        âœ•
      </button>

      <h3 id="modalTitle" class="text-xl font-semibold"></h3>
      <p class="mt-2">Congestion Level: <strong id="modalLevel"></strong></p>
      <p>Average people: <strong id="modalPeople"></strong></p>
      <p>Capacity: <strong id="modalCapacity"></strong></p>
      <p>Percent full: <strong id="modalPercent"></strong>%</p>

      <div class="mt-4 flex justify-end">
        <button
          id="directionsBtn"
          class="bg-teal-500 text-white px-3 py-1 rounded"
        >
          Get Directions
        </button>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}
