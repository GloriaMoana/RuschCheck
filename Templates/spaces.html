{% extends 'layout.html' %} {% block content %}

<div class="max-w-7xl mx-auto">
  <h2 class="text-4xl font-bold mb-8 text-gray-800">Spaces</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    {% for loc in locations %}

    <div
      class="space-card flex bg-white rounded-2xl shadow-md border border-gray-200 overflow-hidden transition-all"
    >
      <!-- Image -->
      <div class="shrink-0">
        <img
          src="{{ url_for('static', filename=loc.image.replace('\\','/')) }}"
          class="w-56 h-full object-cover thumb"
          onerror="this.src='{{ url_for('static', filename='uploads/images/default.jpg') }}'"
        />
      </div>

      <!-- Right side content -->
      <div class="p-6 flex flex-col justify-between flex-1">
        <!-- Title + Indicator -->
        <div class="flex justify-between items-start">
          <div>
            <h3 class="text-2xl font-semibold text-gray-900">{{ loc.name }}</h3>
            <p class="text-gray-500 text-base">Capacity: {{ loc.capacity }}</p>
          </div>

          <div
            id="indicator-{{ loc.id }}"
            class="indicator w-7 h-7 rounded-full border-2 border-gray-300 bg-white"
          ></div>
        </div>

        <!-- Status Info -->
        <div class="mt-4 text-gray-700 text-base">
          <strong class="text-gray-900">Congestion:</strong>
          <span id="cong-{{ loc.id }}">
            {% if loc.id in statuses %} {{ statuses[loc.id].level }} {% else %}
            Not checked {% endif %}
          </span>

          <p class="text-sm text-gray-500 mt-2">
            Last updated:
            <span id="time-{{ loc.id }}">
              {% if loc.id in statuses %} {{ statuses[loc.id].updated_at }} {%
              else %} - {% endif %}
            </span>
          </p>
        </div>

        <!-- Buttons -->
        <div class="flex gap-3 mt-6">
          <!-- Check button -->
          <button
            class="check-btn flex-1 py-2 rounded text-white text-base"
            data-loc="{{ loc.id }}"
          >
            {% if loc.id in statuses %} Check Again {% else %} Check {% endif %}
          </button>

          <!-- Previous button -->
          <button
            class="prev-btn flex-1 bg-gray-200 text-gray-700 py-2 rounded text-sm"
            data-loc="{{ loc.id }}"
          >
            Previous
          </button>

          <!-- Directions -->
          <button
            class="bg-blue-500 text-white px-4 py-2 rounded text-sm"
            onclick="window.open('https://www.google.com/maps/search/?api=1&query={{ loc.address|urlencode }}','_blank')"
          >
            Map
          </button>
        </div>
      </div>
    </div>

    {% endfor %}
  </div>

  <!-- Modal -->
  <div
    id="modal"
    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 hidden"
  >
    <div class="modal-content bg-white rounded-lg p-6 w-[450px] relative">
      <button
        id="modalClose"
        class="modal-close absolute top-3 right-3 text-gray-500 hover:text-gray-700"
      >
        âœ•
      </button>

      <h3 id="modalTitle" class="text-2xl font-semibold"></h3>
      <p class="mt-2 text-lg">
        Congestion Level: <strong id="modalLevel"></strong>
      </p>
      <p class="text-lg">Average people: <strong id="modalPeople"></strong></p>
      <p class="text-lg">Capacity: <strong id="modalCapacity"></strong></p>
      <p class="text-lg">Percent full: <strong id="modalPercent"></strong>%</p>

      <div class="mt-6 flex justify-end">
        <button
          id="directionsBtn"
          class="bg-teal-500 text-white px-4 py-2 rounded text-base"
        >
          Get Directions
        </button>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}
